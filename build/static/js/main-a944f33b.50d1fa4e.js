"use strict";(self.webpackChunkssv_front=self.webpackChunkssv_front||[]).push([[2924],{13272:function(e,n,i){i.d(n,{Z:function(){return y}});var s=i(1413),t=i(4942),a=i(29439),c=i(89480),o=i(72791),l=i(83958),r=i(7477),d=i(50546),u=i(98845),m=i(32014),v=i(57273),h=i(31610),f=i(27582),p=i(87309),b=i(23442),x=i(80184),j=function(e){var n=e.data,i=e.dataSource,d=e.onChange,j=(0,o.useState)({}),g=(0,a.Z)(j,2),N=g[0],Z=g[1],_=(0,o.useState)(""),y=(0,a.Z)(_,2),w=y[0],k=y[1],C=(0,o.useState)({}),I=(0,a.Z)(C,2),S=I[0],E=I[1],O=n.detail,H=u.Z.useForm(),F=(0,a.Z)(H,1)[0],L=function(){if(F){var e=F.getFieldsValue();e&&d("conditions",(0,s.Z)((0,s.Z)({},e),{},{groupId:null===O||void 0===O?void 0:O.groupId,metricId:null===O||void 0===O?void 0:O.id,displayName:null===O||void 0===O?void 0:O.display,showHtml:w,rule_template:null===O||void 0===O?void 0:O.rule_template}))}};(0,o.useEffect)((function(){T("cancel","",i)}),[i]);var T=function(e,n,i,a){if("change"===e){if(S[n]){var c=Array.isArray(i)?a.join("/"):(0,b.td)(a||i);B(n,c),E((0,s.Z)((0,s.Z)({},S),{},(0,t.Z)({},n,c)))}}else if("cancel"===e&&F){var o=F.getFieldsValue();Object.keys(o).forEach((function(e){F.setFieldValue(e,i&&i[e]||"")}))}},B=function(e,n){var i=null===O||void 0===O?void 0:O.rules_hint.replace(/\`/g,""),s=null===i||void 0===i?void 0:i.replace(/\$/g,""),t="";Object.keys(S).forEach((function(i){var a=t||s,c="boolean"!==typeof S[i]?S[i]:"";i===e&&(c=n),t=null===a||void 0===a?void 0:a.replace(new RegExp("{ form.confitions.".concat(i," }"),"g"),c)})),k(t)};(0,o.useEffect)((function(){var e=null===O||void 0===O?void 0:O.rules_hint;if(e){var n,s=e.replace(/\`/g,""),t=null===s||void 0===s?void 0:s.replace(/\$/g,""),a=null===t||void 0===t?void 0:t.replace(/\{.*?\}/g,""),c={};null===t||void 0===t||null===(n=t.match(/\{.*?\}/g))||void 0===n||n.forEach((function(e){var n=(null===e||void 0===e?void 0:e.split("form.confitions.")[1]).split(" }")[0];c[n]=!0})),E(c),k(null!==i&&void 0!==i&&i.showHtml?i.showHtml:a)}}),[O,i]);var A=function(e,n){var i=((null===e||void 0===e?void 0:e.choices)||[]).map((function(e){return{label:e[1],value:e[0]}}));if(e.remote_url&&!N[e.remote_url]&&e.is_remote){"".concat(l.Fy).concat(e.remote_url);r.Z.get("".concat(l.Fy).concat(e.remote_url)).then((function(n){if(n.data){var i=(0,t.Z)({},e.remote_url,n.data.map((function(e){return{label:e[1],value:e[0]}})));Z((0,s.Z)((0,s.Z)({},N),i))}}))}switch(e.type){case"CHOICE":return(0,x.jsx)(m.Z.Group,{onChange:function(e){var s=[];null===e||void 0===e||e.forEach((function(e){var n=i.find((function(n){return n.value===e}));n&&s.push(n.label)})),T("change",n,e,s)},className:"item-checkbox",options:i});case"SELECT":return(0,x.jsx)(v.Z,{showSearch:!0,onChange:function(e,i){var s="address"===n?e:i.label;T("change",n,s)},filterOption:function(e,n){var i,s;return null===(i=String(null!==(s=null===n||void 0===n?void 0:n.label)&&void 0!==s?s:""))||void 0===i?void 0:i.toLowerCase().includes(e.toLowerCase())},className:"item-select default-border",popupClassName:"item-select-wrap",options:i.length>0?i:N[e.remote_url]});case"INPUT":return(0,x.jsx)(h.Z,{addonAfter:null,style:{width:"100%"},onChange:function(e){T("change",n,e)},className:"item-input default-border",defaultValue:n&&(null===F||void 0===F?void 0:F.getFieldValue(n))||""});default:return null}};return(0,x.jsx)(f.Z,{title:"",open:n.show,wrapClassName:"ssv-modal sbuscribe-detail",footer:null,onCancel:function(){return d("show",!1)},children:(0,x.jsxs)("div",{className:"sbuscribe-detail-card",children:[(0,x.jsxs)("h3",{className:"header",children:[(0,c.d)("metric_logo"),(0,x.jsx)("span",{className:"name",children:(null===O||void 0===O?void 0:O.display)||""})]}),(0,x.jsx)("p",{className:"title",children:(0,x.jsx)("span",{className:"title-detail",id:"title-detail-back",dangerouslySetInnerHTML:{__html:w}})}),O&&(0,x.jsxs)(u.Z,{form:F,onFinish:L,layout:"vertical",initialValues:i,className:"from-content sbuscribe-detail-card-content",children:[Object.keys(O.fields_attr||{}).map((function(e){var n=O.fields_attr[e].display;return(0,x.jsx)(u.Z.Item,{name:e,label:(0,x.jsx)("span",{className:"item-label",children:n}),rules:[{required:!0}],children:A(null===O||void 0===O?void 0:O.fields_attr[e],e)},e)})),(0,x.jsx)(u.Z.Item,{className:"from-btns",wrapperCol:{span:24},children:(0,x.jsx)(p.Z,{className:"default-btn",type:"primary",htmlType:"submit",onClick:L,children:"Confirm"})})]})]})})},g=i(13085),N=i(62603),Z=i(57689),_=i(95048),y=o.memo((function(){var e,n,i,u,m=(0,o.useState)([]),v=(0,a.Z)(m,2),h=v[0],f=v[1],y=(0,o.useState)({show:!1}),w=(0,a.Z)(y,2),k=w[0],C=w[1],I=(0,o.useState)(""),S=(0,a.Z)(I,2),E=S[0],O=S[1],H=(0,Z.UO)(),F=(0,o.useState)("conditions"),L=(0,a.Z)(F,2),T=L[0],B=L[1],A=(0,o.useState)({}),V=(0,a.Z)(A,2),z=V[0],M=V[1],U=(0,Z.s0)(),D=(0,_.v9)((function(e){return e.user}),_.wU);(0,o.useEffect)((function(){H.sign&&H.subscribeId&&r.Z.post("".concat(l.bB,"/alerting/alerts/").concat(H.subscribeId,"/confirm-via-sign"),{sign:H.sign&&decodeURIComponent(H.sign)}).then((function(){R()})).catch((function(){R()}))}),[H.sign]);var R=function(){r.Z.get("".concat(l.bB,"alerting/subscribes/").concat(H.subscribeId)).then((function(e){var n=e.data,i=n.notification_type,s=n.metric,a=n.user,c=n.name,o=n.notification_address,l=n.conditions,r={action:(0,t.Z)({},i,o),notification_type:i,notification_address:o,conditions:l,name:c,metric:s,user:a};O(c),M(r),B("all")}))};(0,o.useEffect)((function(){H.subscribeId&&!H.sign&&R()}),[H.subscribeId,H.sign]),(0,o.useEffect)((function(){r.Z.get("".concat(l.bB,"engine/metric-groups")).then((function(e){f(e.data.results)}))}),[]);var P=function(e,n){var i;switch(e){case"conditions":M((0,s.Z)((0,s.Z)({},z),{},{metric:n.metricId,conditions:n})),B(null!==z&&void 0!==z&&z.notification_address?"all":"action");break;case"action":var t=Object.keys(n)[0],a={notification_type:t,notification_address:n[t]};M((0,s.Z)((0,s.Z)({},z),a)),B(null!==z&&void 0!==z&&null!==(i=z.conditions)&&void 0!==i&&i.metricId?"all":"conditions")}C({show:!1,detail:void 0})},$=function(e){B(e)};return(0,x.jsxs)("div",{className:"ssv-subscribe",children:[(0,x.jsx)("h3",{className:"title",children:"Subscription"}),"conditions"===T?(0,x.jsxs)("div",{className:"ssv-subscribe-card",children:[(0,x.jsx)("h3",{className:"title",children:"Choose a Metric"}),(0,x.jsx)("div",{className:"ssv-subscribe-card-item",children:h.map((function(e,n){return(0,x.jsxs)("div",{className:"metric_groups",children:[(0,x.jsxs)("div",{className:"metric_groups_header",children:[(0,c.d)("metric_logo"),(0,x.jsx)("span",{className:"name",children:e.name})]}),(0,x.jsx)("div",{className:"metric_groups_content",children:e.metrics.map((function(n,i){return(0,x.jsx)("div",{className:"token-item",onClick:function(){return function(e){C({show:!0,detail:e})}((0,s.Z)((0,s.Z)({},n),{},{groupId:e.id}))},children:(0,x.jsx)("span",{children:n.display})},i)}))})]},n)}))})]}):(0,x.jsxs)("div",{className:"ssv-subscribe-card",onClick:function(){M((0,s.Z)((0,s.Z)({},z),{},{conditions:{}})),$("conditions")},children:[(0,x.jsx)("h3",{className:"title-text",children:null===z||void 0===z||null===(e=z.conditions)||void 0===e?void 0:e.displayName}),!(null!==z&&void 0!==z&&null!==(n=z.conditions)&&void 0!==n&&n.showHtml)&&(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"title",children:"Choose a Metric"}),(0,x.jsx)("span",{className:"card-icons add-icons",children:(0,x.jsx)("span",{className:"text",children:"+"})})]}),(0,x.jsx)("span",{className:"title-detail",dangerouslySetInnerHTML:{__html:(null===z||void 0===z||null===(i=z.conditions)||void 0===i?void 0:i.showHtml)||""}}),(null===z||void 0===z||null===(u=z.conditions)||void 0===u?void 0:u.showHtml)&&(0,x.jsx)("span",{className:"card-icons",children:(0,c.d)("right_arrow")})]}),(0,x.jsx)(j,{data:k,onChange:P,dataSource:z&&(null===z||void 0===z?void 0:z.conditions)||{}}),(0,x.jsx)("div",{onClick:function(){return $("action")},children:"action"===T?(0,x.jsx)(d.Z,{onChange:P,dataSource:z&&(null===z||void 0===z?void 0:z.action)||{}}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("h3",{className:"title",children:"Notification"}),(0,x.jsxs)("div",{className:"ssv-subscribe-card",onClick:function(){return $("action")},children:[(0,x.jsx)("h3",{className:"title-text",children:(0,b.ZN)(z.notification_type)}),!(null!==z&&void 0!==z&&z.notification_type)&&(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"title",children:"Email/Discord/Wehook"}),(0,x.jsx)("span",{className:"card-icons add-icons",children:(0,x.jsx)("span",{className:"text",children:"+"})})]}),(null===z||void 0===z?void 0:z.notification_type)&&(0,x.jsxs)("span",{className:"title-detail",children:["Send ",null===z||void 0===z?void 0:z.notification_type," notifications to",(0,x.jsx)("span",{style:{marginLeft:6,color:"#1ba5f8"},children:(null===z||void 0===z?void 0:z.notification_address)||""})]}),(null===z||void 0===z?void 0:z.notification_address)&&(0,x.jsx)("span",{className:"card-icons",children:(0,c.d)("right_arrow")})]})]})}),(0,x.jsx)(N.Z,{value:E,className:"subscribe-label",onChange:function(e){return O(e.target.value)},placeholder:"Alert Nickname"}),(0,x.jsx)(p.Z,{className:"default-btn subscribe-btn",onClick:function(){var e=(0,s.Z)((0,s.Z)({},z),{},{name:E,user:D.id});H.subscribeId?r.Z.put("".concat(l.bB,"alerting/subscribes/").concat(H.subscribeId),(0,s.Z)({},e)).then((function(e){U("/subscribe")})).catch((function(e){e.response.data&&g.Z.open({message:"Network error",description:"".concat(e.response.data[Object.keys(e.response.data)[0]])})})):r.Z.post("".concat(l.bB,"alerting/subscribes"),(0,s.Z)({},e)).then((function(e){U("/subscribe")})).catch((function(e){if(e.response.data)if(Object.keys(e.response.data).length>1){var n="";Object.keys(e.response.data).forEach((function(i){n=n.length>0?n+"<br />".concat(i,":").concat(e.response.data[i][0]):"".concat(i,":").concat(e.response.data[i][0])})),g.Z.open({message:"Network error",description:(0,x.jsx)("div",{dangerouslySetInnerHTML:{__html:n}})})}else 1===Object.keys(e.response.data).length&&g.Z.open({message:"Network error",description:"".concat(e.response.data[Object.keys(e.response.data)[0]])})}))},children:H.subscribeId?"Save":"Create"}),(0,x.jsx)(p.Z,{className:"subscribe-btn brack-btn",onClick:function(){U(-1)},children:"Return"})]})}))},4252:function(e,n,i){var s=i(29439),t=i(83958),a=(i(15738),i(89480)),c=i(77616),o=i(87309),l=i(68058),r=i(7477),d=i(72791),u=i(95048),m=i(67838),v=i(57689),h=i(23442),f=i(80184);n.Z=function(){var e=[{title:"Name",dataIndex:"name",width:"35%"},{title:"Notification",dataIndex:"notification_type",width:"25%",render:function(e){return(0,h.ZN)(e.notification_type)}},{title:"",dataIndex:"edit",width:"40%",render:function(e){return(0,f.jsxs)("div",{className:"edit",children:[(0,f.jsxs)("span",{className:"default-border edit-btn",onClick:function(){return T("update",e)},children:[(0,a.d)("update_svg"),(0,f.jsx)("span",{className:"text",children:"update"})]}),(0,f.jsx)(c.Z,{title:"Are you sure to remove this task?",onConfirm:function(){return T("remove",e)},okText:"Yes",cancelText:"No",children:(0,f.jsxs)("span",{className:"default-border edit-btn",children:[(0,a.d)("delete_svg"),(0,f.jsx)("span",{className:"text",children:"remove"})]})})]})}}],n=(0,d.useState)([]),i=(0,s.Z)(n,2),p=i[0],b=i[1],x=(0,v.s0)(),j=(0,d.useState)(1),g=(0,s.Z)(j,2),N=g[0],Z=g[1],_=(0,d.useState)(1),y=(0,s.Z)(_,2),w=y[0],k=y[1],C=(0,d.useState)(!1),I=(0,s.Z)(C,2),S=I[0],E=I[1],O=(0,u.v9)((function(e){return{account:null===e||void 0===e?void 0:e.user.public_key,max_subscribe:null===e||void 0===e?void 0:e.user.max_subscribe}}),u.wU),H=O.account,F=O.max_subscribe,L=function(e){var n={page:e||N,page_size:t.Dh,ordering:"-id"};r.Z.get("".concat(t.bB,"/alerting/subscribes?page=").concat(n.page,"&page_size=").concat(n.page_size,"&&ordering=-id")).then((function(e){var n,i;b((null===(n=e.data)||void 0===n?void 0:n.results)||[]),k(null===(i=e.data)||void 0===i?void 0:i.count),E(!1)})).catch((function(){E(!1)}))};(0,d.useEffect)((function(){H&&(E(!0),L())}),[H]);var T=function(e,n){"update"===e?x("/subscribe/".concat(n.id)):"remove"===e&&r.Z.delete("".concat(t.bB,"alerting/subscribes/").concat(n.id)).then((function(e){L()}))};return(0,f.jsxs)("div",{className:"ssv-main",children:[(0,f.jsxs)("div",{className:"ssv-main-header",children:[(0,f.jsx)("h3",{className:"title",children:"Subscriptions"}),(0,f.jsxs)("div",{className:"ssv-main-header-content",children:[(0,f.jsxs)("div",{className:"limit",children:[(0,f.jsx)("span",{className:"limit-icon",children:"Limit: "}),(0,f.jsxs)("span",{children:[w," / ",F]})]}),(0,f.jsx)(o.Z,{className:"default-btn add-btn",onClick:function(){x("/subscribe/add")},children:"Add"})]})]}),(0,f.jsxs)("div",{className:"ssv-main-content",children:[(0,f.jsx)("ul",{className:"header",children:e.map((function(e,n){return(0,f.jsx)("li",{style:{width:e.width},className:"header-item",children:e.title},n)}))}),S&&(0,f.jsx)("div",{className:"loading",children:(0,f.jsx)(m.Z,{style:{fontSize:50}})}),!S&&(0,f.jsx)("ul",{className:"data-content",children:p.map((function(n,i){return(0,f.jsx)("li",{className:"data-content-item",children:e.map((function(e){var i=e.render?e.render(n):n[e.dataIndex];return(0,f.jsx)("span",{style:{width:e.width},children:i},e.dataIndex)}))},i)}))})]}),(0,f.jsx)(l.Z,{className:"ssv-pagination",defaultCurrent:N,defaultPageSize:t.Dh,total:w,onChange:function(e){Z(e),L(e)}})]})}},15738:function(){}}]);
//# sourceMappingURL=main-a944f33b.50d1fa4e.js.map