"use strict";(self.webpackChunkssv_front=self.webpackChunkssv_front||[]).push([[2924],{13272:function(e,n,s){s.d(n,{Z:function(){return y}});var t=s(1413),i=s(4942),a=s(29439),c=s(89480),l=s(72791),r=s(83958),o=s(7477),d=s(50546),u=s(98845),m=s(32014),h=s(57273),f=s(31610),v=s(27582),p=s(87309),b=s(23442),x=s(80184),j=function(e){var n=e.data,s=e.dataSource,d=e.onChange,j=(0,l.useState)({}),g=(0,a.Z)(j,2),N=g[0],Z=g[1],_=(0,l.useState)(""),y=(0,a.Z)(_,2),w=y[0],k=y[1],C=(0,l.useState)({}),I=(0,a.Z)(C,2),S=I[0],E=I[1],O=n.detail,H=u.Z.useForm(),F=(0,a.Z)(H,1)[0],L=function(){if(F){var e=F.getFieldsValue();e&&d("conditions",(0,t.Z)((0,t.Z)({},e),{},{groupId:null==O?void 0:O.groupId,metricId:null==O?void 0:O.id,displayName:null==O?void 0:O.display,showHtml:w,rule_template:null==O?void 0:O.rule_template}))}};(0,l.useEffect)((function(){T("cancel","",s)}),[s]);var T=function(e,n,s,a){if("change"===e){if(S[n]){var c=Array.isArray(s)?a.join("/"):(0,b.td)(a||s);B(n,c),E((0,t.Z)((0,t.Z)({},S),{},(0,i.Z)({},n,c)))}}else if("cancel"===e&&F){var l=F.getFieldsValue();Object.keys(l).forEach((function(e){F.setFieldValue(e,s&&s[e]||"")}))}},B=function(e,n){var s=null==O?void 0:O.rules_hint.replace(/\`/g,""),t=null==s?void 0:s.replace(/\$/g,""),i="";Object.keys(S).forEach((function(s){var a=i||t,c="boolean"!=typeof S[s]?S[s]:"";s===e&&(c=n),i=null==a?void 0:a.replace(new RegExp("{ form.confitions.".concat(s," }"),"g"),c)})),k(i)};(0,l.useEffect)((function(){var e=null==O?void 0:O.rules_hint;if(e){var n,t=e.replace(/\`/g,""),i=null==t?void 0:t.replace(/\$/g,""),a=null==i?void 0:i.replace(/\{.*?\}/g,""),c={};null==i||null===(n=i.match(/\{.*?\}/g))||void 0===n||n.forEach((function(e){var n=(null==e?void 0:e.split("form.confitions.")[1]).split(" }")[0];c[n]=!0})),E(c),k(null!=s&&s.showHtml?s.showHtml:a)}}),[O,s]);var A=function(e,n){var s=((null==e?void 0:e.choices)||[]).map((function(e){return{label:e[1],value:e[0]}}));switch(e.remote_url&&!N[e.remote_url]&&e.is_remote&&("".concat(r.Fy).concat(e.remote_url),o.Z.get("".concat(r.Fy).concat(e.remote_url)).then((function(n){if(n.data){var s=(0,i.Z)({},e.remote_url,n.data.map((function(e){return{label:e[1],value:e[0]}})));Z((0,t.Z)((0,t.Z)({},N),s))}}))),e.type){case"CHOICE":return(0,x.jsx)(m.Z.Group,{onChange:function(e){var t=[];null==e||e.forEach((function(e){var n=s.find((function(n){return n.value===e}));n&&t.push(n.label)})),T("change",n,e,t)},className:"item-checkbox",options:s});case"SELECT":return(0,x.jsx)(h.Z,{showSearch:!0,onChange:function(e,s){var t="address"===n?e:s.label;T("change",n,t)},filterOption:function(e,n){var s,t;return null===(s=String(null!==(t=null==n?void 0:n.label)&&void 0!==t?t:""))||void 0===s?void 0:s.toLowerCase().includes(e.toLowerCase())},className:"item-select default-border",popupClassName:"item-select-wrap",options:s.length>0?s:N[e.remote_url]});case"INPUT":return(0,x.jsx)(f.Z,{addonAfter:null,style:{width:"100%"},onChange:function(e){T("change",n,e)},className:"item-input default-border",defaultValue:n&&(null==F?void 0:F.getFieldValue(n))||""});default:return null}};return(0,x.jsx)(v.Z,{title:"",open:n.show,wrapClassName:"ssv-modal sbuscribe-detail",footer:null,onCancel:function(){return d("show",!1)},children:(0,x.jsxs)("div",{className:"sbuscribe-detail-card",children:[(0,x.jsxs)("h3",{className:"header",children:[(0,c.d)("metric_logo"),(0,x.jsx)("span",{className:"name",children:(null==O?void 0:O.display)||""})]}),(0,x.jsx)("p",{className:"title",children:(0,x.jsx)("span",{className:"title-detail",id:"title-detail-back",dangerouslySetInnerHTML:{__html:w}})}),O&&(0,x.jsxs)(u.Z,{form:F,onFinish:L,layout:"vertical",initialValues:s,className:"from-content sbuscribe-detail-card-content",children:[Object.keys(O.fields_attr||{}).map((function(e){var n=O.fields_attr[e].display;return(0,x.jsx)(u.Z.Item,{name:e,label:(0,x.jsx)("span",{className:"item-label",children:n}),rules:[{required:!0}],children:A(null==O?void 0:O.fields_attr[e],e)},e)})),(0,x.jsx)(u.Z.Item,{className:"from-btns",wrapperCol:{span:24},children:(0,x.jsx)(p.Z,{className:"default-btn",type:"primary",htmlType:"submit",onClick:L,children:"Confirm"})})]})]})})},g=s(13085),N=s(62603),Z=s(57689),_=s(95048),y=l.memo((function(){var e,n,s,u,m=(0,l.useState)([]),h=(0,a.Z)(m,2),f=h[0],v=h[1],y=(0,l.useState)({show:!1}),w=(0,a.Z)(y,2),k=w[0],C=w[1],I=(0,l.useState)(""),S=(0,a.Z)(I,2),E=S[0],O=S[1],H=(0,Z.UO)(),F=(0,l.useState)("conditions"),L=(0,a.Z)(F,2),T=L[0],B=L[1],A=(0,l.useState)({}),V=(0,a.Z)(A,2),z=V[0],M=V[1],U=(0,Z.s0)(),D=(0,_.v9)((function(e){return e.user}),_.wU);(0,l.useEffect)((function(){H.sign&&H.subscribeId&&o.Z.post("".concat(r.bB,"/alerting/alerts/").concat(H.subscribeId,"/confirm-via-sign"),{sign:H.sign&&decodeURIComponent(H.sign)}).then((function(){R()})).catch((function(){R()}))}),[H.sign]);var R=function(){o.Z.get("".concat(r.bB,"alerting/subscribes/").concat(H.subscribeId)).then((function(e){var n=e.data,s=n.notification_type,t=n.metric,a=n.user,c=n.name,l=n.notification_address,r=n.conditions,o={action:(0,i.Z)({},s,l),notification_type:s,notification_address:l,conditions:r,name:c,metric:t,user:a};O(c),M(o),B("all")}))};(0,l.useEffect)((function(){H.subscribeId&&!H.sign&&R()}),[H.subscribeId,H.sign]),(0,l.useEffect)((function(){o.Z.get("".concat(r.bB,"engine/metric-groups")).then((function(e){v(e.data.results)}))}),[]);var P=function(e,n){var s;switch(e){case"conditions":M((0,t.Z)((0,t.Z)({},z),{},{metric:n.metricId,conditions:n})),B(null!=z&&z.notification_address?"all":"action");break;case"action":var i=Object.keys(n)[0],a={notification_type:i,notification_address:n[i]};M((0,t.Z)((0,t.Z)({},z),a)),B(null!=z&&null!==(s=z.conditions)&&void 0!==s&&s.metricId?"all":"conditions")}C({show:!1,detail:void 0})},$=function(e){B(e)};return(0,x.jsxs)("div",{className:"ssv-subscribe",children:[(0,x.jsx)("h3",{className:"title",children:"Subscription"}),"conditions"===T?(0,x.jsxs)("div",{className:"ssv-subscribe-card",children:[(0,x.jsx)("h3",{className:"title",children:"Choose a Metric"}),(0,x.jsx)("div",{className:"ssv-subscribe-card-item",children:f.map((function(e,n){return(0,x.jsxs)("div",{className:"metric_groups",children:[(0,x.jsxs)("div",{className:"metric_groups_header",children:[(0,c.d)("metric_logo"),(0,x.jsx)("span",{className:"name",children:e.name})]}),(0,x.jsx)("div",{className:"metric_groups_content",children:e.metrics.map((function(n,s){return(0,x.jsx)("div",{className:"token-item",onClick:function(){return function(e){C({show:!0,detail:e})}((0,t.Z)((0,t.Z)({},n),{},{groupId:e.id}))},children:(0,x.jsx)("span",{children:n.display})},s)}))})]},n)}))})]}):(0,x.jsxs)("div",{className:"ssv-subscribe-card",onClick:function(){M((0,t.Z)((0,t.Z)({},z),{},{conditions:{}})),$("conditions")},children:[(0,x.jsx)("h3",{className:"title-text",children:null==z||null===(e=z.conditions)||void 0===e?void 0:e.displayName}),!(null!=z&&null!==(n=z.conditions)&&void 0!==n&&n.showHtml)&&(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"title",children:"Choose a Metric"}),(0,x.jsx)("span",{className:"card-icons add-icons",children:(0,x.jsx)("span",{className:"text",children:"+"})})]}),(0,x.jsx)("span",{className:"title-detail",dangerouslySetInnerHTML:{__html:(null==z||null===(s=z.conditions)||void 0===s?void 0:s.showHtml)||""}}),(null==z||null===(u=z.conditions)||void 0===u?void 0:u.showHtml)&&(0,x.jsx)("span",{className:"card-icons",children:(0,c.d)("right_arrow")})]}),(0,x.jsx)(j,{data:k,onChange:P,dataSource:z&&(null==z?void 0:z.conditions)||{}}),(0,x.jsx)("div",{onClick:function(){return $("action")},children:"action"===T?(0,x.jsx)(d.Z,{onChange:P,dataSource:z&&(null==z?void 0:z.action)||{}}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("h3",{className:"title",children:"Notification"}),(0,x.jsxs)("div",{className:"ssv-subscribe-card",onClick:function(){return $("action")},children:[(0,x.jsx)("h3",{className:"title-text",children:(0,b.ZN)(z.notification_type)}),!(null!=z&&z.notification_type)&&(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"title",children:"Email/Discord/Wehook"}),(0,x.jsx)("span",{className:"card-icons add-icons",children:(0,x.jsx)("span",{className:"text",children:"+"})})]}),(null==z?void 0:z.notification_type)&&(0,x.jsxs)("span",{className:"title-detail",children:["Send ",null==z?void 0:z.notification_type," notifications to",(0,x.jsx)("span",{style:{marginLeft:6,color:"#1ba5f8"},children:(null==z?void 0:z.notification_address)||""})]}),(null==z?void 0:z.notification_address)&&(0,x.jsx)("span",{className:"card-icons",children:(0,c.d)("right_arrow")})]})]})}),(0,x.jsx)(N.Z,{value:E,className:"subscribe-label",onChange:function(e){return O(e.target.value)},placeholder:"Alert Nickname"}),(0,x.jsx)(p.Z,{className:"default-btn subscribe-btn",onClick:function(){var e=(0,t.Z)((0,t.Z)({},z),{},{name:E,user:D.id});H.subscribeId?o.Z.put("".concat(r.bB,"alerting/subscribes/").concat(H.subscribeId),(0,t.Z)({},e)).then((function(e){U("/subscribe")})).catch((function(e){e.response.data&&g.Z.open({message:"Network error",description:"".concat(e.response.data[Object.keys(e.response.data)[0]])})})):o.Z.post("".concat(r.bB,"alerting/subscribes"),(0,t.Z)({},e)).then((function(e){U("/subscribe")})).catch((function(e){if(e.response.data)if(Object.keys(e.response.data).length>1){var n="";Object.keys(e.response.data).forEach((function(s){n=n.length>0?n+"<br />".concat(s,":").concat(e.response.data[s][0]):"".concat(s,":").concat(e.response.data[s][0])})),g.Z.open({message:"Network error",description:(0,x.jsx)("div",{dangerouslySetInnerHTML:{__html:n}})})}else 1===Object.keys(e.response.data).length&&g.Z.open({message:"Network error",description:"".concat(e.response.data[Object.keys(e.response.data)[0]])})}))},children:H.subscribeId?"Save":"Create"}),(0,x.jsx)(p.Z,{className:"subscribe-btn brack-btn",onClick:function(){U(-1)},children:"Return"})]})}))},4252:function(e,n,s){var t=s(29439),i=s(83958),a=(s(15738),s(89480)),c=s(34571),l=s(87309),r=s(68058),o=s(7477),d=s(72791),u=s(95048),m=s(67838),h=s(57689),f=s(23442),v=s(80184);n.Z=function(){var e=[{title:"Name",dataIndex:"name",width:"35%"},{title:"Notification",dataIndex:"notification_type",width:"25%",render:function(e){return(0,f.ZN)(e.notification_type)}},{title:"",dataIndex:"edit",width:"40%",render:function(e){return(0,v.jsxs)("div",{className:"edit",children:[(0,v.jsxs)("span",{className:"default-border edit-btn",onClick:function(){return T("update",e)},children:[(0,a.d)("update_svg"),(0,v.jsx)("span",{className:"text",children:"update"})]}),(0,v.jsx)(c.Z,{title:"Are you sure to remove this task?",onConfirm:function(){return T("remove",e)},okText:"Yes",cancelText:"No",children:(0,v.jsxs)("span",{className:"default-border edit-btn",children:[(0,a.d)("delete_svg"),(0,v.jsx)("span",{className:"text",children:"remove"})]})})]})}}],n=(0,d.useState)([]),s=(0,t.Z)(n,2),p=s[0],b=s[1],x=(0,h.s0)(),j=(0,d.useState)(1),g=(0,t.Z)(j,2),N=g[0],Z=g[1],_=(0,d.useState)(1),y=(0,t.Z)(_,2),w=y[0],k=y[1],C=(0,d.useState)(!1),I=(0,t.Z)(C,2),S=I[0],E=I[1],O=(0,u.v9)((function(e){return{account:null==e?void 0:e.user.public_key,max_subscribe:null==e?void 0:e.user.max_subscribe}}),u.wU),H=O.account,F=O.max_subscribe,L=function(e){var n={page:e||N,page_size:i.Dh,ordering:"-id"};o.Z.get("".concat(i.bB,"/alerting/subscribes?page=").concat(n.page,"&page_size=").concat(n.page_size,"&&ordering=-id")).then((function(e){var n,s;b((null===(n=e.data)||void 0===n?void 0:n.results)||[]),k(null===(s=e.data)||void 0===s?void 0:s.count),E(!1)})).catch((function(){E(!1)}))};(0,d.useEffect)((function(){H&&(E(!0),L())}),[H]);var T=function(e,n){"update"===e?x("/subscribe/".concat(n.id)):"remove"===e&&o.Z.delete("".concat(i.bB,"alerting/subscribes/").concat(n.id)).then((function(e){L()}))};return(0,v.jsxs)("div",{className:"ssv-main",children:[(0,v.jsxs)("div",{className:"ssv-main-header",children:[(0,v.jsx)("h3",{className:"title",children:"Subscriptions"}),(0,v.jsxs)("div",{className:"ssv-main-header-content",children:[(0,v.jsxs)("div",{className:"limit",children:[(0,v.jsx)("span",{className:"limit-icon",children:"Limit: "}),(0,v.jsxs)("span",{children:[w," / ",F]})]}),(0,v.jsx)(l.Z,{className:"default-btn add-btn",onClick:function(){x("/subscribe/add")},children:"Add"})]})]}),(0,v.jsxs)("div",{className:"ssv-main-content",children:[(0,v.jsx)("ul",{className:"header",children:e.map((function(e,n){return(0,v.jsx)("li",{style:{width:e.width},className:"header-item",children:e.title},n)}))}),S&&(0,v.jsx)("div",{className:"loading",children:(0,v.jsx)(m.Z,{style:{fontSize:50}})}),!S&&(0,v.jsx)("ul",{className:"data-content",children:p.map((function(n,s){return(0,v.jsx)("li",{className:"data-content-item",children:e.map((function(e){var s=e.render?e.render(n):n[e.dataIndex];return(0,v.jsx)("span",{style:{width:e.width},children:s},e.dataIndex)}))},s)}))})]}),(0,v.jsx)(r.Z,{className:"ssv-pagination",defaultCurrent:N,defaultPageSize:i.Dh,total:w,onChange:function(e){Z(e),L(e)}})]})}},15738:function(){}}]);
//# sourceMappingURL=main-a944f33b.f111cbfe.js.map